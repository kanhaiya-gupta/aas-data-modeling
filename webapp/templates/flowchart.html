{% extends "base.html" %}

{% block title %}Processing Flow - AASX Digital Twin Analytics Framework{% endblock %}

{% block extra_head %}
<style>
    .flowchart-container {
        background: #f8fafc;
        border-radius: 10px;
        padding: 30px;
        margin: 20px 0;
        min-height: 600px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .mermaid {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 1400px;
    }
    .mermaid svg {
        width: 100% !important;
        height: auto !important;
        min-width: 1000px !important;
    }
    .description {
        background: #ecf0f1;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 5px solid #2563eb;
    }
    .description h3 {
        color: #1e293b;
        margin-top: 0;
    }
    .description p {
        margin: 10px 0;
        line-height: 1.6;
    }
    .flow-steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }
    .flow-step {
        background: #f8fafc;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #2563eb;
    }
    .flow-step h4 {
        color: #1e293b;
        margin-top: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .flow-step p {
        margin: 10px 0 0 0;
        color: #64748b;
    }
    .page-header {
        text-align: center;
        margin-bottom: 30px;
    }
    .page-header h1 {
        color: #1e293b;
        margin-bottom: 10px;
    }
    .page-header p {
        color: #64748b;
        font-size: 1.1em;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="page-header">
        <h1>
            <i class="fas fa-project-diagram text-primary me-3"></i>
            Framework Processing Flow
        </h1>
        <p>Complete architecture and data flow of the AASX Digital Twin Analytics Framework</p>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-sitemap me-2"></i>
                        Processing Flowchart
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="flowchart-container">
                        <div class="mermaid" id="aasx-flowchart">
                            graph TD
                                %% Input Sources
                                A1[AASX Files<br/>üì¶] --> B1[AASX ETL Pipeline<br/>‚öôÔ∏è]
                                A2[Additive Manufacturing<br/>üè≠] --> A1
                                A3[Hydrogen Filling Station<br/>‚õΩ] --> A1
                                A4[Smart Grid Substation<br/>‚ö°] --> A1
                                A5[Wastewater Treatment<br/>üíß] --> A1
                                
                                %% ETL Processing
                                B1 --> C1[Data Extraction<br/>üì§]
                                C1 --> D1[Data Transformation<br/>üîÑ]
                                D1 --> E1[Data Loading<br/>üì•]
                                
                                %% Data Storage
                                E1 --> F1[Structured Data<br/>üìä]
                                E1 --> G1[Vector Embeddings<br/>üß†]
                                E1 --> H1[Metadata<br/>üè∑Ô∏è]
                                
                                %% Knowledge Graph
                                F1 --> I1[Knowledge Graph<br/>üï∏Ô∏è<br/>Neo4j]
                                H1 --> I1
                                
                                %% Vector Database
                                G1 --> J1[Vector Database<br/>üîç<br/>Qdrant]
                                
                                %% AI/RAG System
                                K1[Natural Language Query<br/>‚ùì] --> L1[AI/RAG System<br/>ü§ñ]
                                L1 --> M1[Query Understanding<br/>üß†]
                                M1 --> N1[Semantic Search<br/>üîç]
                                M1 --> O1[Graph Query<br/>üï∏Ô∏è]
                                
                                %% Search Sources
                                N1 --> J1
                                O1 --> I1
                                
                                %% Results Processing
                                N1 --> P1[Retrieved Documents<br/>üìÑ]
                                O1 --> Q1[Graph Results<br/>üï∏Ô∏è]
                                P1 --> R1[Answer Synthesis<br/>üß†]
                                Q1 --> R1
                                R1 --> S1[AI-Generated Response<br/>üí¨]
                                
                                %% Management Systems
                                F1 --> T1[Digital Twin Registry<br/>üîÑ]
                                H1 --> U1[Certificate Manager<br/>üìú]
                                
                                %% Analytics
                                I1 --> V1[Analytics Dashboard<br/>üìä]
                                J1 --> V1
                                T1 --> V1
                                U1 --> V1
                                
                                %% Output
                                V1 --> W1[Actionable Insights<br/>üí°]
                                S1 --> W1
                                
                                %% Styling
                                classDef inputNode fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
                                classDef processNode fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
                                classDef storageNode fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
                                classDef aiNode fill:#fff3e0,stroke:#f57c00,stroke-width:2px
                                classDef outputNode fill:#fce4ec,stroke:#c2185b,stroke-width:2px
                                
                                class A1,A2,A3,A4,A5 inputNode
                                class B1,C1,D1,E1,L1,M1,N1,O1,R1 processNode
                                class F1,G1,H1,I1,J1 storageNode
                                class K1,S1 aiNode
                                class T1,U1,V1,W1 outputNode
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        Flow Description
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="description">
                        <h3>Framework Flow Description</h3>
                        <p>The AASX Digital Twin Analytics Framework follows a comprehensive processing flow that transforms AASX files into actionable insights through multiple stages of data processing, analysis, and management.</p>
                        
                        <div class="flow-steps">
                            <div class="flow-step">
                                <h4><i class="fas fa-cogs text-primary"></i> 1. AASX ETL Pipeline</h4>
                                <p>Processes AASX files from various infrastructure sources (additive manufacturing, hydrogen stations, smart grids, etc.) through extraction, transformation, and loading phases.</p>
                            </div>
                            
                            <div class="flow-step">
                                <h4><i class="fas fa-project-diagram text-success"></i> 2. Knowledge Graph Construction</h4>
                                <p>Builds Neo4j-based knowledge graphs from structured data and metadata, creating relationship networks between assets, properties, and components.</p>
                            </div>
                            
                            <div class="flow-step">
                                <h4><i class="fas fa-robot text-warning"></i> 3. AI/RAG Analysis</h4>
                                <p>Provides intelligent analysis through OpenAI integration, combining semantic search and graph queries to generate comprehensive responses to natural language questions.</p>
                            </div>
                            
                            <div class="flow-step">
                                <h4><i class="fas fa-sync text-info"></i> 4. Digital Twin Management</h4>
                                <p>Manages digital twin registrations and monitors asset health through the twin registry and certificate management systems.</p>
                            </div>
                            
                            <div class="flow-step">
                                <h4><i class="fas fa-chart-bar text-danger"></i> 5. Analytics & Insights</h4>
                                <p>Generates actionable insights through the analytics dashboard, combining data from all sources to provide comprehensive digital twin analytics.</p>
                            </div>
                        </div>
                        
                        <p><strong>Goal</strong>: This framework transforms complex AASX data into actionable insights through automated ETL processing, intelligent AI analysis, and comprehensive digital twin management, supporting critical infrastructure operations and decision-making.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
<script>
    mermaid.initialize({
        startOnLoad: true,
        theme: 'default',
        flowchart: {
            useMaxWidth: true,
            htmlLabels: true,
            curve: 'basis',
            nodeSpacing: 50,
            rankSpacing: 70,
            diagramPadding: 20
        },
        fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif',
        fontSize: 12
    });
</script>
{% endblock %} 