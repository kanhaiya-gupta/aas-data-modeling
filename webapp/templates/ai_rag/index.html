{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0">
                        <i class="fas fa-robot text-primary"></i>
                        AI/RAG System
                    </h1>
                    <p class="text-muted mb-0">AI-powered analysis and insights for digital twins</p>
                </div>
                <div class="d-flex gap-2">
                    <button id="refreshAnalysis" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i>
                        Refresh Analysis
                    </button>
                    <button id="newQuery" class="btn btn-outline-secondary">
                        <i class="fas fa-plus"></i>
                        New Query
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-left-primary shadow h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                AI Models
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">3</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-brain fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-left-success shadow h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Active Queries
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">12</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-search fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-left-info shadow h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Knowledge Base
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">1.2K</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-database fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-left-warning shadow h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Response Time
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">2.3s</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-clock fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row">
        <!-- Query Interface -->
        <div class="col-lg-8">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-comments"></i>
                        AI Query Interface
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="queryInput" class="form-label">Ask about your digital twins:</label>
                        <textarea class="form-control" id="queryInput" rows="3" placeholder="e.g., What are the quality metrics for the additive manufacturing facility?"></textarea>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" id="submitQuery">
                            <i class="fas fa-paper-plane"></i>
                            Submit Query
                        </button>
                        <button class="btn btn-outline-secondary" id="clearQuery">
                            <i class="fas fa-eraser"></i>
                            Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- Query Results -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-lightbulb"></i>
                        Analysis Results
                    </h6>
                </div>
                <div class="card-body">
                    <div id="queryResults">
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-robot fa-3x mb-3"></i>
                            <p>Submit a query to get AI-powered insights about your digital twins.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Recent Queries -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-history"></i>
                        Recent Queries
                    </h6>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Quality Assessment</strong>
                                <br><small class="text-muted">Additive Manufacturing Facility</small>
                            </div>
                            <small class="text-muted">2 min ago</small>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Performance Analysis</strong>
                                <br><small class="text-muted">Hydrogen Filling Station</small>
                            </div>
                            <small class="text-muted">15 min ago</small>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Maintenance Schedule</strong>
                                <br><small class="text-muted">Servo DC Motor</small>
                            </div>
                            <small class="text-muted">1 hour ago</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Models Status -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-cogs"></i>
                        AI Models Status
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Quality Analysis Model</span>
                            <span class="badge bg-success">Active</span>
                        </div>
                        <div class="progress mt-1" style="height: 5px;">
                            <div class="progress-bar bg-success" style="width: 95%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Performance Prediction</span>
                            <span class="badge bg-success">Active</span>
                        </div>
                        <div class="progress mt-1" style="height: 5px;">
                            <div class="progress-bar bg-success" style="width: 88%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Anomaly Detection</span>
                            <span class="badge bg-warning">Training</span>
                        </div>
                        <div class="progress mt-1" style="height: 5px;">
                            <div class="progress-bar bg-warning" style="width: 65%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // Submit query
    $('#submitQuery').click(function() {
        var query = $('#queryInput').val().trim();
        if (!query) {
            alert('Please enter a query');
            return;
        }
        
        // Show loading
        $('#queryResults').html(`
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Analyzing your query...</p>
            </div>
        `);
        
        // Simulate AI response
        setTimeout(function() {
            var response = generateAIResponse(query);
            $('#queryResults').html(response);
        }, 2000);
    });
    
    // Clear query
    $('#clearQuery').click(function() {
        $('#queryInput').val('');
        $('#queryResults').html(`
            <div class="text-center text-muted py-4">
                <i class="fas fa-robot fa-3x mb-3"></i>
                <p>Submit a query to get AI-powered insights about your digital twins.</p>
            </div>
        `);
    });
    
    // Refresh analysis
    $('#refreshAnalysis').click(function() {
        location.reload();
    });
    
    // New query
    $('#newQuery').click(function() {
        $('#queryInput').focus();
    });
});

function generateAIResponse(query) {
    var responses = {
        'quality': `
            <div class="alert alert-info">
                <h6><i class="fas fa-chart-line"></i> Quality Analysis Results</h6>
                <p>Based on the digital twin data analysis:</p>
                <ul>
                    <li><strong>Overall Quality Score:</strong> 94.2%</li>
                    <li><strong>Dimensional Accuracy:</strong> ±0.02mm</li>
                    <li><strong>Surface Finish:</strong> Ra 3.2μm</li>
                    <li><strong>Material Properties:</strong> Within specifications</li>
                </ul>
                <p class="mb-0"><strong>Recommendation:</strong> Continue current manufacturing parameters for optimal quality.</p>
            </div>
        `,
        'performance': `
            <div class="alert alert-success">
                <h6><i class="fas fa-tachometer-alt"></i> Performance Analysis</h6>
                <p>Performance metrics analysis:</p>
                <ul>
                    <li><strong>Efficiency:</strong> 87.3%</li>
                    <li><strong>Throughput:</strong> 45 parts/hour</li>
                    <li><strong>Energy Consumption:</strong> 2.1 kWh/part</li>
                    <li><strong>Uptime:</strong> 96.8%</li>
                </ul>
                <p class="mb-0"><strong>Insight:</strong> Performance is above industry average with room for optimization.</p>
            </div>
        `,
        'maintenance': `
            <div class="alert alert-warning">
                <h6><i class="fas fa-tools"></i> Maintenance Analysis</h6>
                <p>Maintenance schedule recommendations:</p>
                <ul>
                    <li><strong>Next Maintenance:</strong> 15 days</li>
                    <li><strong>Critical Components:</strong> Motor bearings, drive belts</li>
                    <li><strong>Estimated Duration:</strong> 4 hours</li>
                    <li><strong>Required Parts:</strong> Bearing set, belt kit</li>
                </ul>
                <p class="mb-0"><strong>Action:</strong> Schedule preventive maintenance to avoid downtime.</p>
            </div>
        `
    };
    
    query = query.toLowerCase();
    if (query.includes('quality')) return responses.quality;
    if (query.includes('performance')) return responses.performance;
    if (query.includes('maintenance')) return responses.maintenance;
    
    return `
        <div class="alert alert-primary">
            <h6><i class="fas fa-lightbulb"></i> AI Analysis</h6>
            <p>Based on your query: "${query}"</p>
            <p>The AI system has analyzed the digital twin data and found relevant insights. 
            The system is processing multiple data sources including sensor readings, 
            historical performance data, and quality metrics.</p>
            <p class="mb-0"><strong>Next Steps:</strong> Consider reviewing the detailed analytics dashboard for more specific insights.</p>
        </div>
    `;
}
</script>
{% endblock %} 